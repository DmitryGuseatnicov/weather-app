import{m as sr,B as pr,n as la,i as Sr,k as ca,g as dr,p as Or,f as b,e as C,a as ga,l as ha,r as pa,b as yr,c as Nr,u as Ur,h as ya,T as ea,P as Ma,j as tr,o as F,q as ta,s as Lr,t as Ia,S as Xr,R as Ta,v as W,w as K,x as La,y as rr,z as _r,A as k,C as z,D as B,E as ur,F as _a,G as xa,H as Yr}from"./index-CBOPitKI.js";import{p as Da,s as Ga,a as Ea,h as Ra,D as qr}from"./labelLayoutHelper-DUvzaPM2.js";import{s as Pa,g as ma,u as Hr}from"./labelGuideHelper-CKKyxFOA.js";function Ca(a){if(a){for(var r=[],n=0;n<a.length;n++)r.push(a[n].slice());return r}}function Aa(a,r){var n=a.label,e=r&&r.getTextGuideLine();return{dataIndex:a.dataIndex,dataType:a.dataType,seriesIndex:a.seriesModel.seriesIndex,text:a.label.style.text,rect:a.hostRect,labelRect:a.rect,align:n.style.align,verticalAlign:n.style.verticalAlign,labelLinePoints:Ca(e&&e.shape.points)}}var Vr=["align","verticalAlign","width","height","fontSize"],S=new ea,fr=sr(),Sa=sr();function ar(a,r,n){for(var e=0;e<n.length;e++){var t=n[e];r[t]!=null&&(a[t]=r[t])}}var er=["x","y","rotation"],Oa=function(){function a(){this._labelList=[],this._chartViewList=[]}return a.prototype.clearLabels=function(){this._labelList=[],this._chartViewList=[]},a.prototype._addLabel=function(r,n,e,t,i){var o=t.style,v=t.__hostTarget,d=v.textConfig||{},s=t.getComputedTransform(),u=t.getBoundingRect().plain();pr.applyTransform(u,u,s),s?S.setLocalTransform(s):(S.x=S.y=S.rotation=S.originX=S.originY=0,S.scaleX=S.scaleY=1),S.rotation=la(S.rotation);var l=t.__hostTarget,f;if(l){f=l.getBoundingRect().plain();var c=l.getComputedTransform();pr.applyTransform(f,f,c)}var p=f&&l.getTextGuideLine();this._labelList.push({label:t,labelLine:p,seriesModel:e,dataIndex:r,dataType:n,layoutOption:i,computedLayoutOption:null,rect:u,hostRect:f,priority:f?f.width*f.height:0,defaultAttr:{ignore:t.ignore,labelGuideIgnore:p&&p.ignore,x:S.x,y:S.y,scaleX:S.scaleX,scaleY:S.scaleY,rotation:S.rotation,style:{x:o.x,y:o.y,align:o.align,verticalAlign:o.verticalAlign,width:o.width,height:o.height,fontSize:o.fontSize},cursor:t.cursor,attachedPos:d.position,attachedRot:d.rotation}})},a.prototype.addLabelsOfSeries=function(r){var n=this;this._chartViewList.push(r);var e=r.__model,t=e.get("labelLayout");(Sr(t)||ca(t).length)&&r.group.traverse(function(i){if(i.ignore)return!0;var o=i.getTextContent(),v=dr(i);o&&!o.disableLabelLayout&&n._addLabel(v.dataIndex,v.dataType,e,o,t)})},a.prototype.updateLayoutConfig=function(r){var n=r.getWidth(),e=r.getHeight();function t(y,G){return function(){Hr(y,G)}}for(var i=0;i<this._labelList.length;i++){var o=this._labelList[i],v=o.label,d=v.__hostTarget,s=o.defaultAttr,u=void 0;Sr(o.layoutOption)?u=o.layoutOption(Aa(o,d)):u=o.layoutOption,u=u||{},o.computedLayoutOption=u;var l=Math.PI/180;d&&d.setTextConfig({local:!1,position:u.x!=null||u.y!=null?null:s.attachedPos,rotation:u.rotate!=null?u.rotate*l:s.attachedRot,offset:[u.dx||0,u.dy||0]});var f=!1;if(u.x!=null?(v.x=Or(u.x,n),v.setStyle("x",0),f=!0):(v.x=s.x,v.setStyle("x",s.style.x)),u.y!=null?(v.y=Or(u.y,e),v.setStyle("y",0),f=!0):(v.y=s.y,v.setStyle("y",s.style.y)),u.labelLinePoints){var c=d.getTextGuideLine();c&&(c.setShape({points:u.labelLinePoints}),f=!1)}var p=fr(v);p.needsUpdateLabelLine=f,v.rotation=u.rotate!=null?u.rotate*l:s.rotation,v.scaleX=s.scaleX,v.scaleY=s.scaleY;for(var g=0;g<Vr.length;g++){var h=Vr[g];v.setStyle(h,u[h]!=null?u[h]:s.style[h])}if(u.draggable){if(v.draggable=!0,v.cursor="move",d){var L=o.seriesModel;if(o.dataIndex!=null){var D=o.seriesModel.getData(o.dataType);L=D.getItemModel(o.dataIndex)}v.on("drag",t(d,L.getModel("labelLine")))}}else v.off("drag"),v.cursor=s.cursor}},a.prototype.layout=function(r){var n=r.getWidth(),e=r.getHeight(),t=Da(this._labelList),i=b(t,function(d){return d.layoutOption.moveOverlap==="shiftX"}),o=b(t,function(d){return d.layoutOption.moveOverlap==="shiftY"});Ga(i,0,n),Ea(o,0,e);var v=b(t,function(d){return d.layoutOption.hideOverlap});Ra(v)},a.prototype.processLabelsOverall=function(){var r=this;C(this._chartViewList,function(n){var e=n.__model,t=n.ignoreLabelLineUpdate,i=e.isAnimationEnabled();n.group.traverse(function(o){if(o.ignore&&!o.forceLabelAnimation)return!0;var v=!t,d=o.getTextContent();!v&&d&&(v=fr(d).needsUpdateLabelLine),v&&r._updateLabelLine(o,e),i&&r._animateLabels(o,e)})})},a.prototype._updateLabelLine=function(r,n){var e=r.getTextContent(),t=dr(r),i=t.dataIndex;if(e&&i!=null){var o=n.getData(t.dataType),v=o.getItemModel(i),d={},s=o.getItemVisual(i,"style");if(s){var u=o.getVisual("drawType");d.stroke=s[u]}var l=v.getModel("labelLine");Pa(r,ma(v),d),Hr(r,l)}},a.prototype._animateLabels=function(r,n){var e=r.getTextContent(),t=r.getTextGuideLine();if(e&&(r.forceLabelAnimation||!e.ignore&&!e.invisible&&!r.disableLabelAnimation&&!ga(r))){var i=fr(e),o=i.oldLayout,v=dr(r),d=v.dataIndex,s={x:e.x,y:e.y,rotation:e.rotation},u=n.getData(v.dataType);if(o){e.attr(o);var f=r.prevStates;f&&(Nr(f,"select")>=0&&e.attr(i.oldLayoutSelect),Nr(f,"emphasis")>=0&&e.attr(i.oldLayoutEmphasis)),Ur(e,s,n,d)}else if(e.attr(s),!ha(e).valueAnimation){var l=pa(e.style.opacity,1);e.style.opacity=0,yr(e,{style:{opacity:l}},n,d)}if(i.oldLayout=s,e.states.select){var c=i.oldLayoutSelect={};ar(c,s,er),ar(c,e.states.select,er)}if(e.states.emphasis){var p=i.oldLayoutEmphasis={};ar(p,s,er),ar(p,e.states.emphasis,er)}ya(e,d,u,n,n)}if(t&&!t.ignore&&!t.invisible){var i=Sa(t),o=i.oldLayout,g={points:t.shape.points};o?(t.attr({shape:o}),Ur(t,{shape:g},n)):(t.setShape(g),t.style.strokePercent=0,yr(t,{style:{strokePercent:1}},n)),i.oldLayout=g}},a}(),lr=sr();function de(a){a.registerUpdateLifecycle("series:beforeupdate",function(r,n,e){var t=lr(n).labelManager;t||(t=lr(n).labelManager=new Oa),t.clearLabels()}),a.registerUpdateLifecycle("series:layoutlabels",function(r,n,e){var t=lr(n).labelManager;e.updatedSeries.forEach(function(i){t.addLabelsOfSeries(n.getViewOfSeriesModel(i))}),t.updateLayoutConfig(n),t.layout(n),t.processLabelsOverall()})}var q=Ma.CMD;function $(a,r){return Math.abs(a-r)<1e-5}function Mr(a){var r=a.data,n=a.len(),e=[],t,i=0,o=0,v=0,d=0;function s(P,m){t&&t.length>2&&e.push(t),t=[P,m]}function u(P,m,A,R){$(P,A)&&$(m,R)||t.push(P,m,A,R,A,R)}function l(P,m,A,R,U,X){var Y=Math.abs(m-P),H=Math.tan(Y/4)*4/3,Z=m<P?-1:1,Dr=Math.cos(P),Gr=Math.sin(P),Er=Math.cos(m),Rr=Math.sin(m),ua=Dr*U+A,fa=Gr*X+R,Pr=Er*U+A,mr=Rr*X+R,Cr=U*H*Z,Ar=X*H*Z;t.push(ua-Cr*Gr,fa+Ar*Dr,Pr+Cr*Rr,mr-Ar*Er,Pr,mr)}for(var f,c,p,g,h=0;h<n;){var L=r[h++],D=h===1;switch(D&&(i=r[h],o=r[h+1],v=i,d=o,(L===q.L||L===q.C||L===q.Q)&&(t=[v,d])),L){case q.M:i=v=r[h++],o=d=r[h++],s(v,d);break;case q.L:f=r[h++],c=r[h++],u(i,o,f,c),i=f,o=c;break;case q.C:t.push(r[h++],r[h++],r[h++],r[h++],i=r[h++],o=r[h++]);break;case q.Q:f=r[h++],c=r[h++],p=r[h++],g=r[h++],t.push(i+2/3*(f-i),o+2/3*(c-o),p+2/3*(f-p),g+2/3*(c-g),p,g),i=p,o=g;break;case q.A:var y=r[h++],G=r[h++],M=r[h++],I=r[h++],_=r[h++],x=r[h++]+_;h+=1;var T=!r[h++];f=Math.cos(_)*M+y,c=Math.sin(_)*I+G,D?(v=f,d=c,s(v,d)):u(i,o,f,c),i=Math.cos(x)*M+y,o=Math.sin(x)*I+G;for(var E=(T?-1:1)*Math.PI/2,O=_;T?O>x:O<x;O+=E){var N=T?Math.max(O+E,x):Math.min(O+E,x);l(O,N,y,G,M,I)}break;case q.R:v=i=r[h++],d=o=r[h++],f=v+r[h++],c=d+r[h++],s(f,d),u(f,d,f,c),u(f,c,v,c),u(v,c,v,d),u(v,d,f,d);break;case q.Z:t&&u(i,o,v,d),i=v,o=d;break}}return t&&t.length>2&&e.push(t),e}function Ir(a,r,n,e,t,i,o,v,d,s){if($(a,n)&&$(r,e)&&$(t,o)&&$(i,v)){d.push(o,v);return}var u=2/s,l=u*u,f=o-a,c=v-r,p=Math.sqrt(f*f+c*c);f/=p,c/=p;var g=n-a,h=e-r,L=t-o,D=i-v,y=g*g+h*h,G=L*L+D*D;if(y<l&&G<l){d.push(o,v);return}var M=f*g+c*h,I=-f*L-c*D,_=y-M*M,x=G-I*I;if(_<l&&M>=0&&x<l&&I>=0){d.push(o,v);return}var T=[],E=[];tr(a,n,t,o,.5,T),tr(r,e,i,v,.5,E),Ir(T[0],E[0],T[1],E[1],T[2],E[2],T[3],E[3],d,s),Ir(T[4],E[4],T[5],E[5],T[6],E[6],T[7],E[7],d,s)}function Na(a,r){var n=Mr(a),e=[];r=r||1;for(var t=0;t<n.length;t++){var i=n[t],o=[],v=i[0],d=i[1];o.push(v,d);for(var s=2;s<i.length;){var u=i[s++],l=i[s++],f=i[s++],c=i[s++],p=i[s++],g=i[s++];Ir(v,d,u,l,f,c,p,g,o,r),v=p,d=g}e.push(o)}return e}function na(a,r,n){var e=a[r],t=a[1-r],i=Math.abs(e/t),o=Math.ceil(Math.sqrt(i*n)),v=Math.floor(n/o);v===0&&(v=1,o=n);for(var d=[],s=0;s<o;s++)d.push(v);var u=o*v,l=n-u;if(l>0)for(var s=0;s<l;s++)d[s%o]+=1;return d}function Zr(a,r,n){for(var e=a.r0,t=a.r,i=a.startAngle,o=a.endAngle,v=Math.abs(o-i),d=v*t,s=t-e,u=d>Math.abs(s),l=na([d,s],u?0:1,r),f=(u?v:s)/l.length,c=0;c<l.length;c++)for(var p=(u?s:v)/l[c],g=0;g<l[c];g++){var h={};u?(h.startAngle=i+f*c,h.endAngle=i+f*(c+1),h.r0=e+p*g,h.r=e+p*(g+1)):(h.startAngle=i+p*g,h.endAngle=i+p*(g+1),h.r0=e+f*c,h.r=e+f*(c+1)),h.clockwise=a.clockwise,h.cx=a.cx,h.cy=a.cy,n.push(h)}}function Ua(a,r,n){for(var e=a.width,t=a.height,i=e>t,o=na([e,t],i?0:1,r),v=i?"width":"height",d=i?"height":"width",s=i?"x":"y",u=i?"y":"x",l=a[v]/o.length,f=0;f<o.length;f++)for(var c=a[d]/o[f],p=0;p<o[f];p++){var g={};g[s]=f*l,g[u]=p*c,g[v]=l,g[d]=c,g.x+=a.x,g.y+=a.y,n.push(g)}}function Qr(a,r,n,e){return a*e-n*r}function Xa(a,r,n,e,t,i,o,v){var d=n-a,s=e-r,u=o-t,l=v-i,f=Qr(u,l,d,s);if(Math.abs(f)<1e-6)return null;var c=a-t,p=r-i,g=Qr(c,p,u,l)/f;return g<0||g>1?null:new W(g*d+a,g*s+r)}function Ya(a,r,n){var e=new W;W.sub(e,n,r),e.normalize();var t=new W;W.sub(t,a,r);var i=t.dot(e);return i}function j(a,r){var n=a[a.length-1];n&&n[0]===r[0]&&n[1]===r[1]||a.push(r)}function qa(a,r,n){for(var e=a.length,t=[],i=0;i<e;i++){var o=a[i],v=a[(i+1)%e],d=Xa(o[0],o[1],v[0],v[1],r.x,r.y,n.x,n.y);d&&t.push({projPt:Ya(d,r,n),pt:d,idx:i})}if(t.length<2)return[{points:a},{points:a}];t.sort(function(h,L){return h.projPt-L.projPt});var s=t[0],u=t[t.length-1];if(u.idx<s.idx){var l=s;s=u,u=l}for(var f=[s.pt.x,s.pt.y],c=[u.pt.x,u.pt.y],p=[f],g=[c],i=s.idx+1;i<=u.idx;i++)j(p,a[i].slice());j(p,c),j(p,f);for(var i=u.idx+1;i<=s.idx+e;i++)j(g,a[i%e].slice());return j(g,f),j(g,c),[{points:p},{points:g}]}function Wr(a){var r=a.points,n=[],e=[];ta(r,n,e);var t=new pr(n[0],n[1],e[0]-n[0],e[1]-n[1]),i=t.width,o=t.height,v=t.x,d=t.y,s=new W,u=new W;return i>o?(s.x=u.x=v+i/2,s.y=d,u.y=d+o):(s.y=u.y=d+o/2,s.x=v,u.x=v+i),qa(r,s,u)}function nr(a,r,n,e){if(n===1)e.push(r);else{var t=Math.floor(n/2),i=a(r);nr(a,i[0],t,e),nr(a,i[1],n-t,e)}return e}function Ha(a,r){for(var n=[],e=0;e<r;e++)n.push(Lr(a));return n}function Va(a,r){r.setStyle(a.style),r.z=a.z,r.z2=a.z2,r.zlevel=a.zlevel}function Za(a){for(var r=[],n=0;n<a.length;)r.push([a[n++],a[n++]]);return r}function Qa(a,r){var n=[],e=a.shape,t;switch(a.type){case"rect":Ua(e,r,n),t=Ta;break;case"sector":Zr(e,r,n),t=Xr;break;case"circle":Zr({r0:0,r:e.r,startAngle:0,endAngle:Math.PI*2,cx:e.cx,cy:e.cy},r,n),t=Xr;break;default:var i=a.getComputedTransform(),o=i?Math.sqrt(Math.max(i[0]*i[0]+i[1]*i[1],i[2]*i[2]+i[3]*i[3])):1,v=F(Na(a.getUpdatedPathProxy(),o),function(L){return Za(L)}),d=v.length;if(d===0)nr(Wr,{points:v[0]},r,n);else if(d===r)for(var s=0;s<d;s++)n.push({points:v[s]});else{var u=0,l=F(v,function(L){var D=[],y=[];ta(L,D,y);var G=(y[1]-D[1])*(y[0]-D[0]);return u+=G,{poly:L,area:G}});l.sort(function(L,D){return D.area-L.area});for(var f=r,s=0;s<d;s++){var c=l[s];if(f<=0)break;var p=s===d-1?f:Math.ceil(c.area/u*r);p<0||(nr(Wr,{points:c.poly},p,n),f-=p)}}t=Ia;break}if(!t)return Ha(a,r);for(var g=[],s=0;s<n.length;s++){var h=new t;h.setShape(n[s]),Va(a,h),g.push(h)}return g}function Wa(a,r){var n=a.length,e=r.length;if(n===e)return[a,r];for(var t=[],i=[],o=n<e?a:r,v=Math.min(n,e),d=Math.abs(e-n)/6,s=(v-2)/6,u=Math.ceil(d/s)+1,l=[o[0],o[1]],f=d,c=2;c<v;){var p=o[c-2],g=o[c-1],h=o[c++],L=o[c++],D=o[c++],y=o[c++],G=o[c++],M=o[c++];if(f<=0){l.push(h,L,D,y,G,M);continue}for(var I=Math.min(f,u-1)+1,_=1;_<=I;_++){var x=_/I;tr(p,h,D,G,x,t),tr(g,L,y,M,x,i),p=t[3],g=i[3],l.push(t[1],i[1],t[2],i[2],p,g),h=t[5],L=i[5],D=t[6],y=i[6]}f-=I-1}return o===a?[l,r]:[a,l]}function Kr(a,r){for(var n=a.length,e=a[n-2],t=a[n-1],i=[],o=0;o<r.length;)i[o++]=e,i[o++]=t;return i}function Ka(a,r){for(var n,e,t,i=[],o=[],v=0;v<Math.max(a.length,r.length);v++){var d=a[v],s=r[v],u=void 0,l=void 0;d?s?(n=Wa(d,s),u=n[0],l=n[1],e=u,t=l):(l=Kr(t||d,d),u=d):(u=Kr(e||s,s),l=s),i.push(u),o.push(l)}return[i,o]}function jr(a){for(var r=0,n=0,e=0,t=a.length,i=0,o=t-2;i<t;o=i,i+=2){var v=a[o],d=a[o+1],s=a[i],u=a[i+1],l=v*u-s*d;r+=l,n+=(v+s)*l,e+=(d+u)*l}return r===0?[a[0]||0,a[1]||0]:[n/r/3,e/r/3,r]}function ja(a,r,n,e){for(var t=(a.length-2)/6,i=1/0,o=0,v=a.length,d=v-2,s=0;s<t;s++){for(var u=s*6,l=0,f=0;f<v;f+=2){var c=f===0?u:(u+f-2)%d+2,p=a[c]-n[0],g=a[c+1]-n[1],h=r[f]-e[0],L=r[f+1]-e[1],D=h-p,y=L-g;l+=D*D+y*y}l<i&&(i=l,o=s)}return o}function Ja(a){for(var r=[],n=a.length,e=0;e<n;e+=2)r[e]=a[n-e-2],r[e+1]=a[n-e-1];return r}function $a(a,r,n,e){for(var t=[],i,o=0;o<a.length;o++){var v=a[o],d=r[o],s=jr(v),u=jr(d);i==null&&(i=s[2]<0!=u[2]<0);var l=[],f=[],c=0,p=1/0,g=[],h=v.length;i&&(v=Ja(v));for(var L=ja(v,d,s,u)*6,D=h-2,y=0;y<D;y+=2){var G=(L+y)%D+2;l[y+2]=v[G]-s[0],l[y+3]=v[G+1]-s[1]}if(l[0]=v[L]-s[0],l[1]=v[L+1]-s[1],n>0)for(var M=e/n,I=-e/2;I<=e/2;I+=M){for(var _=Math.sin(I),x=Math.cos(I),T=0,y=0;y<v.length;y+=2){var E=l[y],O=l[y+1],N=d[y]-u[0],P=d[y+1]-u[1],m=N*x-P*_,A=N*_+P*x;g[y]=m,g[y+1]=A;var R=m-E,U=A-O;T+=R*R+U*U}if(T<p){p=T,c=I;for(var X=0;X<g.length;X++)f[X]=g[X]}}else for(var Y=0;Y<h;Y+=2)f[Y]=d[Y]-u[0],f[Y+1]=d[Y+1]-u[1];t.push({from:l,to:f,fromCp:s,toCp:u,rotation:-c})}return t}function ir(a){return a.__isCombineMorphing}var ia="__mOriginal_";function vr(a,r,n){var e=ia+r,t=a[e]||a[r];a[e]||(a[e]=a[r]);var i=n.replace,o=n.after,v=n.before;a[r]=function(){var d=arguments,s;return v&&v.apply(this,d),i?s=i.apply(this,d):s=t.apply(this,d),o&&o.apply(this,d),s}}function w(a,r){var n=ia+r;a[n]&&(a[r]=a[n],a[n]=null)}function Jr(a,r){for(var n=0;n<a.length;n++)for(var e=a[n],t=0;t<e.length;){var i=e[t],o=e[t+1];e[t++]=r[0]*i+r[2]*o+r[4],e[t++]=r[1]*i+r[3]*o+r[5]}}function va(a,r){var n=a.getUpdatedPathProxy(),e=r.getUpdatedPathProxy(),t=Ka(Mr(n),Mr(e)),i=t[0],o=t[1],v=a.getComputedTransform(),d=r.getComputedTransform();function s(){this.transform=null}v&&Jr(i,v),d&&Jr(o,d),vr(r,"updateTransform",{replace:s}),r.transform=null;var u=$a(i,o,10,Math.PI),l=[];vr(r,"buildPath",{replace:function(f){for(var c=r.__morphT,p=1-c,g=[],h=0;h<u.length;h++){var L=u[h],D=L.from,y=L.to,G=L.rotation*c,M=L.fromCp,I=L.toCp,_=Math.sin(G),x=Math.cos(G);La(g,M,I,c);for(var T=0;T<D.length;T+=2){var E=D[T],O=D[T+1],N=y[T],P=y[T+1],m=E*p+N*c,A=O*p+P*c;l[T]=m*x-A*_+g[0],l[T+1]=m*_+A*x+g[1]}var R=l[0],U=l[1];f.moveTo(R,U);for(var T=2;T<D.length;){var N=l[T++],P=l[T++],X=l[T++],Y=l[T++],H=l[T++],Z=l[T++];R===N&&U===P&&X===H&&Y===Z?f.lineTo(H,Z):f.bezierCurveTo(N,P,X,Y,H,Z),R=H,U=Z}}}})}function xr(a,r,n){if(!a||!r)return r;var e=n.done,t=n.during;va(a,r),r.__morphT=0;function i(){w(r,"buildPath"),w(r,"updateTransform"),r.__morphT=-1,r.createPathProxy(),r.dirtyShape()}return r.animateTo({__morphT:1},K({during:function(o){r.dirtyShape(),t&&t(o)},done:function(){i(),e&&e()}},n)),r}function Fa(a,r,n,e,t,i){var o=16;a=t===n?0:Math.round(32767*(a-n)/(t-n)),r=i===e?0:Math.round(32767*(r-e)/(i-e));for(var v=0,d,s=(1<<o)/2;s>0;s/=2){var u=0,l=0;(a&s)>0&&(u=1),(r&s)>0&&(l=1),v+=s*s*(3*u^l),l===0&&(u===1&&(a=s-1-a,r=s-1-r),d=a,a=r,r=d)}return v}function or(a){var r=1/0,n=1/0,e=-1/0,t=-1/0,i=F(a,function(v){var d=v.getBoundingRect(),s=v.getComputedTransform(),u=d.x+d.width/2+(s?s[4]:0),l=d.y+d.height/2+(s?s[5]:0);return r=Math.min(u,r),n=Math.min(l,n),e=Math.max(u,e),t=Math.max(l,t),[u,l]}),o=F(i,function(v,d){return{cp:v,z:Fa(v[0],v[1],r,n,e,t),path:a[d]}});return o.sort(function(v,d){return v.z-d.z}).map(function(v){return v.path})}function oa(a){return Qa(a.path,a.count)}function Tr(){return{fromIndividuals:[],toIndividuals:[],count:0}}function ba(a,r,n){var e=[];function t(M){for(var I=0;I<M.length;I++){var _=M[I];ir(_)?t(_.childrenRef()):_ instanceof rr&&e.push(_)}}t(a);var i=e.length;if(!i)return Tr();var o=n.dividePath||oa,v=o({path:r,count:i});if(v.length!==i)return console.error("Invalid morphing: unmatched splitted path"),Tr();e=or(e),v=or(v);for(var d=n.done,s=n.during,u=n.individualDelay,l=new ea,f=0;f<i;f++){var c=e[f],p=v[f];p.parent=r,p.copyTransform(l),u||va(c,p)}r.__isCombineMorphing=!0,r.childrenRef=function(){return v};function g(M){for(var I=0;I<v.length;I++)v[I].addSelfToZr(M)}vr(r,"addSelfToZr",{after:function(M){g(M)}}),vr(r,"removeSelfFromZr",{after:function(M){for(var I=0;I<v.length;I++)v[I].removeSelfFromZr(M)}});function h(){r.__isCombineMorphing=!1,r.__morphT=-1,r.childrenRef=null,w(r,"addSelfToZr"),w(r,"removeSelfFromZr")}var L=v.length;if(u)for(var D=L,y=function(){D--,D===0&&(h(),d&&d())},f=0;f<L;f++){var G=u?K({delay:(n.delay||0)+u(f,L,e[f],v[f]),done:y},n):n;xr(e[f],v[f],G)}else r.__morphT=0,r.animateTo({__morphT:1},K({during:function(M){for(var I=0;I<L;I++){var _=v[I];_.__morphT=r.__morphT,_.dirtyShape()}s&&s(M)},done:function(){h();for(var M=0;M<a.length;M++)w(a[M],"updateTransform");d&&d()}},n));return r.__zr&&g(r.__zr),{fromIndividuals:e,toIndividuals:v,count:L}}function za(a,r,n){var e=r.length,t=[],i=n.dividePath||oa;function o(c){for(var p=0;p<c.length;p++){var g=c[p];ir(g)?o(g.childrenRef()):g instanceof rr&&t.push(g)}}if(ir(a)){o(a.childrenRef());var v=t.length;if(v<e)for(var d=0,s=v;s<e;s++)t.push(Lr(t[d++%v]));t.length=e}else{t=i({path:a,count:e});for(var u=a.getComputedTransform(),s=0;s<t.length;s++)t[s].setLocalTransform(u);if(t.length!==e)return console.error("Invalid morphing: unmatched splitted path"),Tr()}t=or(t),r=or(r);for(var l=n.individualDelay,s=0;s<e;s++){var f=l?K({delay:(n.delay||0)+l(s,e,t[s],r[s])},n):n;xr(t[s],r[s],f)}return{fromIndividuals:t,toIndividuals:r,count:r.length}}function $r(a){return k(a[0])}function Fr(a,r){for(var n=[],e=a.length,t=0;t<e;t++)n.push({one:a[t],many:[]});for(var t=0;t<r.length;t++){var i=r[t].length,o=void 0;for(o=0;o<i;o++)n[o%e].many.push(r[t][o])}for(var v=0,t=e-1;t>=0;t--)if(!n[t].many.length){var d=n[v].many;if(d.length<=1)if(v)v=0;else return n;var i=d.length,s=Math.ceil(i/2);n[t].many=d.slice(s,i),n[v].many=d.slice(0,s),v++}return n}var Ba={clone:function(a){for(var r=[],n=1-Math.pow(1-a.path.style.opacity,1/a.count),e=0;e<a.count;e++){var t=Lr(a.path);t.setStyle("opacity",n),r.push(t)}return r},split:null};function cr(a,r,n,e,t,i){if(!a.length||!r.length)return;var o=_r("update",e,t);if(!(o&&o.duration>0))return;var v=e.getModel("universalTransition").get("delay"),d=Object.assign({setToFinal:!0},o),s,u;$r(a)&&(s=a,u=r),$r(r)&&(s=r,u=a);function l(L,D,y,G,M){var I=L.many,_=L.one;if(I.length===1&&!M){var x=D?I[0]:_,T=D?_:I[0];if(ir(x))l({many:[x],one:T},!0,y,G,!0);else{var E=v?K({delay:v(y,G)},d):d;xr(x,T,E),i(x,T,x,T,E)}}else for(var O=K({dividePath:Ba[n],individualDelay:v&&function(U,X,Y,H){return v(U+y,G)}},d),N=D?ba(I,_,O):za(_,I,O),P=N.fromIndividuals,m=N.toIndividuals,A=P.length,R=0;R<A;R++){var E=v?K({delay:v(R,A)},d):d;i(P[R],m[R],D?I[R]:L.one,D?L.one:I[R],E)}}for(var f=s?s===a:a.length>r.length,c=s?Fr(u,s):Fr(f?r:a,[f?a:r]),p=0,g=0;g<c.length;g++)p+=c[g].many.length;for(var h=0,g=0;g<c.length;g++)l(c[g],f,h,p),h+=c[g].many.length}function Q(a){if(!a)return[];if(k(a)){for(var r=[],n=0;n<a.length;n++)r.push(Q(a[n]));return r}var e=[];return a.traverse(function(t){t instanceof rr&&!t.disableMorphing&&!t.invisible&&!t.ignore&&e.push(t)}),e}var sa=1e4,wa=0,br=1,zr=2,ka=sr();function re(a,r){for(var n=a.dimensions,e=0;e<n.length;e++){var t=a.getDimensionInfo(n[e]);if(t&&t.otherDims[r]===0)return n[e]}}function ae(a,r,n){var e=a.getDimensionInfo(n),t=e&&e.ordinalMeta;if(e){var i=a.get(e.name,r);return t&&t.categories[i]||i+""}}function Br(a,r,n,e){var t=e?"itemChildGroupId":"itemGroupId",i=re(a,t);if(i){var o=ae(a,r,i);return o}var v=a.getRawDataItem(r),d=e?"childGroupId":"groupId";if(v&&v[d])return v[d]+"";if(!e)return n||a.getId(r)}function wr(a){var r=[];return C(a,function(n){var e=n.data,t=n.dataGroupId;if(!(e.count()>sa))for(var i=e.getIndices(),o=0;o<i.length;o++)r.push({data:e,groupId:Br(e,o,t,!1),childGroupId:Br(e,o,t,!0),divide:n.divide,dataIndex:o})}),r}function gr(a,r,n){a.traverse(function(e){e instanceof rr&&yr(e,{style:{opacity:0}},r,{dataIndex:n,isFrom:!0})})}function hr(a){if(a.parent){var r=a.getComputedTransform();a.setLocalTransform(r),a.parent.remove(a)}}function J(a){a.stopAnimation(),a.isGroup&&a.traverse(function(r){r.stopAnimation()})}function ee(a,r,n){var e=_r("update",n,r);e&&a.traverse(function(t){if(t instanceof _a){var i=xa(t);i&&t.animateFrom({style:i},e)}})}function te(a,r){var n=a.length;if(n!==r.length)return!1;for(var e=0;e<n;e++){var t=a[e],i=r[e];if(t.data.getId(t.dataIndex)!==i.data.getId(i.dataIndex))return!1}return!0}function da(a,r,n){var e=wr(a),t=wr(r);function i(y,G,M,I,_){(M||y)&&G.animateFrom({style:M&&M!==y?Yr(Yr({},M.style),y.style):y.style},_)}var o=!1,v=wa,d=B(),s=B();e.forEach(function(y){y.groupId&&d.set(y.groupId,!0),y.childGroupId&&s.set(y.childGroupId,!0)});for(var u=0;u<t.length;u++){var l=t[u].groupId;if(s.get(l)){v=br;break}var f=t[u].childGroupId;if(f&&d.get(f)){v=zr;break}}function c(y,G){return function(M){var I=M.data,_=M.dataIndex;return G?I.getId(_):y?v===br?M.childGroupId:M.groupId:v===zr?M.childGroupId:M.groupId}}var p=te(e,t),g={};if(!p)for(var u=0;u<t.length;u++){var h=t[u],L=h.data.getItemGraphicEl(h.dataIndex);L&&(g[L.id]=!0)}function D(y,G){var M=e[G],I=t[y],_=I.data.hostModel,x=M.data.getItemGraphicEl(M.dataIndex),T=I.data.getItemGraphicEl(I.dataIndex);if(x===T){T&&ee(T,I.dataIndex,_);return}x&&g[x.id]||T&&(J(T),x?(J(x),hr(x),o=!0,cr(Q(x),Q(T),I.divide,_,y,i)):gr(T,_,y))}new qr(e,t,c(!0,p),c(!1,p),null,"multiple").update(D).updateManyToOne(function(y,G){var M=t[y],I=M.data,_=I.hostModel,x=I.getItemGraphicEl(M.dataIndex),T=b(F(G,function(E){return e[E].data.getItemGraphicEl(e[E].dataIndex)}),function(E){return E&&E!==x&&!g[E.id]});x&&(J(x),T.length?(C(T,function(E){J(E),hr(E)}),o=!0,cr(Q(T),Q(x),M.divide,_,y,i)):gr(x,_,M.dataIndex))}).updateOneToMany(function(y,G){var M=e[G],I=M.data.getItemGraphicEl(M.dataIndex);if(!(I&&g[I.id])){var _=b(F(y,function(T){return t[T].data.getItemGraphicEl(t[T].dataIndex)}),function(T){return T&&T!==I}),x=t[y[0]].data.hostModel;_.length&&(C(_,function(T){return J(T)}),I?(J(I),hr(I),o=!0,cr(Q(I),Q(_),M.divide,x,y[0],i)):C(_,function(T){return gr(T,x,y[0])}))}}).updateManyToMany(function(y,G){new qr(G,y,function(M){return e[M].data.getId(e[M].dataIndex)},function(M){return t[M].data.getId(t[M].dataIndex)}).update(function(M,I){D(y[M],G[I])}).execute()}).execute(),o&&C(r,function(y){var G=y.data,M=G.hostModel,I=M&&n.getViewOfSeriesModel(M),_=_r("update",M,0);I&&M.isAnimationEnabled()&&_&&_.duration>0&&I.group.traverse(function(x){x instanceof rr&&!x.animators.length&&x.animateFrom({style:{opacity:0}},_)})})}function kr(a){var r=a.getModel("universalTransition").get("seriesKey");return r||a.id}function ra(a){return k(a)?a.sort().join(","):a}function V(a){if(a.hostModel)return a.hostModel.getModel("universalTransition").get("divideShape")}function ne(a,r){var n=B(),e=B(),t=B();return C(a.oldSeries,function(i,o){var v=a.oldDataGroupIds[o],d=a.oldData[o],s=kr(i),u=ra(s);e.set(u,{dataGroupId:v,data:d}),k(s)&&C(s,function(l){t.set(l,{key:u,dataGroupId:v,data:d})})}),C(r.updatedSeries,function(i){if(i.isUniversalTransitionEnabled()&&i.isAnimationEnabled()){var o=i.get("dataGroupId"),v=i.getData(),d=kr(i),s=ra(d),u=e.get(s);if(u)n.set(s,{oldSeries:[{dataGroupId:u.dataGroupId,divide:V(u.data),data:u.data}],newSeries:[{dataGroupId:o,divide:V(v),data:v}]});else if(k(d)){var l=[];C(d,function(p){var g=e.get(p);g.data&&l.push({dataGroupId:g.dataGroupId,divide:V(g.data),data:g.data})}),l.length&&n.set(s,{oldSeries:l,newSeries:[{dataGroupId:o,data:v,divide:V(v)}]})}else{var f=t.get(d);if(f){var c=n.get(f.key);c||(c={oldSeries:[{dataGroupId:f.dataGroupId,data:f.data,divide:V(f.data)}],newSeries:[]},n.set(f.key,c)),c.newSeries.push({dataGroupId:o,data:v,divide:V(v)})}}}}),n}function aa(a,r){for(var n=0;n<a.length;n++){var e=r.seriesIndex!=null&&r.seriesIndex===a[n].seriesIndex||r.seriesId!=null&&r.seriesId===a[n].id;if(e)return n}}function ie(a,r,n,e){var t=[],i=[];C(z(a.from),function(o){var v=aa(r.oldSeries,o);v>=0&&t.push({dataGroupId:r.oldDataGroupIds[v],data:r.oldData[v],divide:V(r.oldData[v]),groupIdDim:o.dimension})}),C(z(a.to),function(o){var v=aa(n.updatedSeries,o);if(v>=0){var d=n.updatedSeries[v].getData();i.push({dataGroupId:r.oldDataGroupIds[v],data:d,divide:V(d),groupIdDim:o.dimension})}}),t.length>0&&i.length>0&&da(t,i,e)}function ue(a){a.registerUpdateLifecycle("series:beforeupdate",function(r,n,e){C(z(e.seriesTransition),function(t){C(z(t.to),function(i){for(var o=e.updatedSeries,v=0;v<o.length;v++)(i.seriesIndex!=null&&i.seriesIndex===o[v].seriesIndex||i.seriesId!=null&&i.seriesId===o[v].id)&&(o[v][ur]=!0)})})}),a.registerUpdateLifecycle("series:transition",function(r,n,e){var t=ka(n);if(t.oldSeries&&e.updatedSeries&&e.optionChanged){var i=e.seriesTransition;if(i)C(z(i),function(c){ie(c,t,e,n)});else{var o=ne(t,e);C(o.keys(),function(c){var p=o.get(c);da(p.oldSeries,p.newSeries,n)})}C(e.updatedSeries,function(c){c[ur]&&(c[ur]=!1)})}for(var v=r.getSeries(),d=t.oldSeries=[],s=t.oldDataGroupIds=[],u=t.oldData=[],l=0;l<v.length;l++){var f=v[l].getData();f.count()<sa&&(d.push(v[l]),s.push(v[l].get("dataGroupId")),u.push(f))}})}export{de as LabelLayout,ue as UniversalTransition};
